#/bin/env bash

# Add a function for a yes or no prompt
fn() {
	while true; do
		case $input in
			[yY][eE][sS]|[yY])
				output=true
				break
				;;
			[nN][oO]|[nN])
				output=false
				break
		       		;;
			*)
				echo "Invalid input..."
				unset input
				read input
				;;
		esac
	done
}


#Assign pv
declare -a pvcandidates
while true ; do
	echo 'Please enter physcal device path or press Enter to skip'
	echo "available paritions are" 
	if [[ -n ${pvcandidates[*]} ]];then 
		echo "${pvcandidates[@]}"
		echo " " 
		echo "$(lsblk -o name,type,fstype,size | awk -F'-' '/part\s{2}/ {$1="" ;printf "/dev/"; print $2}')" \
			| grep -v $(printf '%s\n' "${pvcandidates[@]}")
	else
		echo "$(lsblk -o name,type,fstype,size \
			| awk -F'-' '/part\s{2}/ {$1="" ; print $2}')"
	fi
	read pvinput
	
	# if blank line entered then exit loop 

	if [[ -z $pvinput ]]; then
	       	echo "No input given not assigning any new partitions" 
		break
	
	# verify disk is valid
	
	elif [[ ! $(sudo fdisk -l | awk '/^\/dev/ {print $1}' | egrep  "^$pvinput"$) ]]; then 
		echo $pvinput not a valid partion
	
	# verify not already entered
	
	elif [[ $(printf '%s\n' "${pvcandidates[@]}" | grep -w -P "$pvinput") ]]; then
		echo "$pvinput already enterd"
	
	else	
		pvcandidates+=($pvinput) 
		echo "partition $pvinput valid"
		echo ${pvcandidates[@]}
		echo "would you like to enter anther partition"
		read input
		fn input 
		if [[ $output == false ]]; then
			break
		fi
#	else
	fi
done
#	else
#		
#		break
#	fi
pvs
# assign volume group
echo "Enter volume group name"
read vgname
if [[ ! -z $pvinput ]] ; then
		read -r -p "Do you want to create a volume group using $pvinput" input 
		fn input
		if [[ $output == true ]]; then
			physical-volumes=$output
fi

while true; do
	echo "would you like to add another physical volume"
	fn input
	if [[ output == true ]]; then
		echo "Please enter disk names"
		read pvnames
		if [[ $(sudo pvs | grep "$pvnames" ) ]] ; then
			echo "$pvnames is valid and will be used"
		else 
			echo "Device $pvnames is not valid"
		fi
	else
		break
	fi
done
